"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function getFormattedDate(e){return[e.getFullYear(),("0"+(e.getMonth()+1)).slice(-2),("0"+e.getDate()).slice(-2)].join("-")}function getFormattedDateTime(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=[("0"+e.getHours()).slice(-2),("0"+e.getMinutes()).slice(-2),("0"+e.getSeconds()).slice(-2)].join(":");if(t){var a=e.getHours();a>12&&(a%=12);var i="am";e.getHours()>=12&&(i="pm"),s=[("0"+a).slice(-2),("0"+e.getMinutes()).slice(-2)].join(":"),s=s+" "+i}return getFormattedDate(e)+" "+s}function getDaysInMonth(e,t){return new Date(e,t+1,0).getDate()}function getClassNameFromSelector(e){return e.replace(".","")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,s,a){return s&&e(t.prototype,s),a&&e(t,a),t}}(),EVENT_DATE_PICKER_YEAR_UPDATE="date-picker:year-update",EVENT_DATE_PICKER_MONTH_UPDATE="date-picker:month-update",EVENT_DATE_PICKER_FORCE_EDIT="date-picker:force-edit",EVENT_DATE_PICKER_ENTER="date-picker:enter",EVENT_DATE_PICKER_EXIT="date-picker:exit",DatePicker=function(){function e(t){_classCallCheck(this,e),this.defaults={},this.cssSelectors={dp:".c-date-picker",dpFocused:".c-date-picker--focused",dpDisplay:".c-date-picker__display",dpDropDown:".c-date-picker__drop-down",dpYearWrapper:".c-date-picker__year-wrapper",dpMonthWrapper:".c-date-picker__month-wrapper",dpMonth:".c-date-picker__month",dpCalWrapper:".c-date-picker__cal-wrapper",dpWeekWrapper:".c-date-picker__week-wrapper",dpDate:".c-date-picker__date",dpTimeWrapper:".c-date-picker__time-wrapper",dpSelectMenuLabel:".c-date-picker__select-label",dpSelectMenu:".c-date-picker__select",dpOverlay:".c-date-picker__overlay",focus:".focus",active:".active",empty:".empty",disabled:".disabled",jsPrevYear:".js-date-picker-prev-year",jsYear:".js-date-picker-year",jsNextYear:".js-date-picker-next-year",jsHour:".js-date-picker-hour",jsMinute:".js-date-picker-minute",jsMeridian:".js-date-picker-meridian"},this.$input=t,this.parseInputAttrs(),this.setup(),this.bindUIActions()}return _createClass(e,null,[{key:"FORMAT_DATE",get:function(){return"date"}},{key:"FORMAT_DATETIME",get:function(){return"datetime"}}]),_createClass(e,[{key:"parseInputAttrs",value:function(){function t(e){var t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1),a=new Date(t.getFullYear(),t.getMonth(),t.getDate()-1);switch(e){case"yesterday":return a;case"today":return t;case"tomorrow":return s;default:return new Date(e)}}var s=this.$input.data("min-date"),a=t(s);isNaN(a)||(this.defaults.minDate=a);var i=this.$input.data("max-date");if(i){var r=t(i);this.defaults.maxDate=isNaN(r)?null:r}if(this.defaults.minDate&&this.defaults.maxDate&&this.defaults.minDate>this.defaults.maxDate)throw console.log(this.$input.get(0)),Error("min-date is greater than max-date");var l=this.$input.val(),o=t(l);isNaN(o)?this.defaults.value=t("today"):this.defaults.value=o;var n=this.$input.data("format");n||(n=e.FORMAT_DATE),-1!==[e.FORMAT_DATE,e.FORMAT_DATETIME].indexOf(n)&&(this.defaults.format=n)}},{key:"setup",value:function(){var t=getClassNameFromSelector(this.cssSelectors.dp),s=getClassNameFromSelector(this.cssSelectors.dpDisplay),a=getClassNameFromSelector(this.cssSelectors.dpDropDown);this.$dp=$('<div class="'+t+'"></div>'),this.$dp.insertAfter(this.$input),this.$dpDisplay=$('<input type="text" class="'+s+'" readonly>');var i=getFormattedDate(this.defaults.value);this.defaults.format===e.FORMAT_DATETIME&&(i=getFormattedDateTime(this.defaults.value,!0)),this.$dpDisplay.val(i),this.$dp.append(this.$dpDisplay);var r=$('<div class="'+a+'"></div>');this.$dp.append(r),this.$dpYearWrapper=$(this.getYearWrapperHtml()),r.append(this.$dpYearWrapper),this.$dpMonthWrapper=$(this.getMonthWrapperHtml()),r.append(this.$dpMonthWrapper),this.$dpCalWrapper=$(this.getCalWrapperHtml()),r.append(this.$dpCalWrapper),this.defaults.format===e.FORMAT_DATETIME&&(this.$dpTimeWrapper=$(this.getTimeWrapperHtml()),r.append(this.$dpTimeWrapper)),this.$input.attr("type","hidden"),this.$dp.append(this.$input),this.$dpOverlay=$(this.getOverlayHtml()),this.$dp.append(this.$dpOverlay),this.$year=this.$dp.find(this.cssSelectors.jsYear),this.$hour=this.$dp.find(this.cssSelectors.jsHour),this.$minute=this.$dp.find(this.cssSelectors.jsMinute),this.$meridian=this.$dp.find(this.cssSelectors.jsMeridian)}},{key:"bindUIActions",value:function(){this.$dp.on("focus",this.show.bind(this)),this.$dpDisplay.on("focus",this.show.bind(this)),this.$dpOverlay.on("click",this.hide.bind(this)),this.$dp.on("click",this.cssSelectors.jsPrevYear,function(){this.$year.val(parseInt(this.$year.val())-1),this.$dp.trigger(EVENT_DATE_PICKER_YEAR_UPDATE)}.bind(this)),this.$dp.on("click",this.cssSelectors.jsNextYear,function(){this.$year.val(parseInt(this.$year.val())+1),this.$dp.trigger(EVENT_DATE_PICKER_YEAR_UPDATE)}.bind(this)),this.$year.on("change",function(e){this.updateMonth()}.bind(this));var e=getClassNameFromSelector(this.cssSelectors.disabled);this.$year.on("keyup",function(t){if(13!==t.keyCode)return this.$dpMonthWrapper.addClass(e),void this.$dpCalWrapper.addClass(e);this.$dpMonthWrapper.removeClass(e),this.$dpCalWrapper.removeClass(e),this.$dpMonthWrapper.focus(),this.navigateMonthsWithKeys()}.bind(this)),this.$year.on("blur",function(e){this.$dpMonthWrapper.focus()}.bind(this)),this.$dp.on(EVENT_DATE_PICKER_YEAR_UPDATE,this.updateMonth.bind(this)),this.$dp.on(EVENT_DATE_PICKER_MONTH_UPDATE,this.updateCal.bind(this)),this.$dp.on("keyup",this.cssSelectors.dpMonthWrapper,this.navigateMonthsWithKeys.bind(this)),this.$dp.on("click",this.cssSelectors.dpMonth,this.selectMonth.bind(this)),this.$dp.on("keyup",this.cssSelectors.dpCalWrapper,this.navigateDateWithKeys.bind(this)),this.$dp.on("click",this.cssSelectors.dpDate,this.selectDate.bind(this)),this.$dp.on(EVENT_DATE_PICKER_FORCE_EDIT,this.forceEditHandler.bind(this)),this.$dp.on("click",this.cssSelectors.dpTimeWrapper+" button",this.setTimeAndHide.bind(this)),$("body").on(EVENT_DATE_PICKER_ENTER,function(e){e.target!==this.$dp.get(0)&&(this.$dp.removeAttr("tabindex"),this.$dpDisplay.attr("disabled",!0))}.bind(this)),$("body").on(EVENT_DATE_PICKER_EXIT,function(e){e.target!==this.$dp.get(0)&&(this.$dp.attr("tabindex","0"),this.$dpDisplay.removeAttr("disabled"))}.bind(this))}},{key:"show",value:function(){this.reset(),this.$dp.addClass(getClassNameFromSelector(this.cssSelectors.dpFocused)),$("html,body").css({overflow:"hidden"}),this.$dp.trigger(EVENT_DATE_PICKER_ENTER)}},{key:"hide",value:function(){this.$dp.removeClass(getClassNameFromSelector(this.cssSelectors.dpFocused)),$("html,body").css({overflow:"auto"}),this.$dp.trigger(EVENT_DATE_PICKER_EXIT),this.$dp.blur()}},{key:"forceEditHandler",value:function(){this.show(),this.$dp.focus()}},{key:"reset",value:function(){this.$year.val(this.defaults.value.getFullYear()),this.$dpMonthWrapper.remove(),this.$dpMonthWrapper=$(this.getMonthWrapperHtml()),this.$dpMonthWrapper.insertAfter(this.$dpYearWrapper),this.$dpCalWrapper.remove(),this.$dpCalWrapper=$(this.getCalWrapperHtml()),this.$dpCalWrapper.insertAfter(this.$dpMonthWrapper)}},{key:"updateMonth",value:function(){var e=this.$dpMonthWrapper;this.$dpMonthWrapper=$(this.getMonthWrapperHtml()),e.replaceWith(this.$dpMonthWrapper),this.$dp.trigger(EVENT_DATE_PICKER_MONTH_UPDATE)}},{key:"updateCal",value:function(){this.$dpCalWrapper.remove(),this.$dpCalWrapper=$(this.getCalWrapperHtml()),this.$dpCalWrapper.insertAfter(this.$dpMonthWrapper)}},{key:"navigateMonthsWithKeys",value:function(e){var t=getClassNameFromSelector(this.cssSelectors.focus),s=getClassNameFromSelector(this.cssSelectors.disabled);if(!this.$dpMonthWrapper.hasClass(s)){var a=this.$dp.find(this.cssSelectors.dpMonth+this.cssSelectors.focus);if(a.length||(a=this.$dp.find(this.cssSelectors.dpMonth+this.cssSelectors.active),a.addClass(t)),a.length||(a=this.$dp.find(this.cssSelectors.dpMonth+":not("+this.cssSelectors.disabled+")").first(),a.addClass(t)),e){var i;switch(e.keyCode){case 37:i=a.prev(),i.length||(i=a.siblings(":last")),i.hasClass(s)&&(i=a.siblings(":not("+this.cssSelectors.disabled+")").last()),i.addClass(t).siblings().removeClass(t);break;case 39:i=a.next(),i.length||(i=a.siblings(":first")),i.hasClass(s)&&(i=a.siblings(":not("+this.cssSelectors.disabled+")").first()),i.addClass(t).siblings().removeClass(t);break;case 38:case 40:var r=this.$dp.find(this.cssSelectors.dpMonth),l=r.index(a);i=l<6?r.eq(l+6):r.eq(l-6),i.hasClass(s)||i.addClass(t).siblings().removeClass(t);break;case 13:a.click(),this.$dpCalWrapper.focus(),this.navigateDateWithKeys()}}}}},{key:"navigateDateWithKeys",value:function(e){var t=this.$dp.find(this.cssSelectors.dpDate).filter(":not("+this.cssSelectors.empty+")"),s=getClassNameFromSelector(this.cssSelectors.focus),a=getClassNameFromSelector(this.cssSelectors.disabled);if(!this.$dpCalWrapper.hasClass(a)){var i=t.filter(this.cssSelectors.focus);if(i.length||(i=t.filter(":not("+this.cssSelectors.disabled+")").first(),i.addClass(s)),e){var r,l=t.index(i);switch(e.keyCode){case 37:r=0===l?t.filter(":not("+this.cssSelectors.disabled+")").last():t.eq(l-1),r.hasClass(a)&&(r=t.filter(":not("+this.cssSelectors.disabled+")").last()),r.addClass(s).siblings().removeClass(s);break;case 39:r=l===t.length-1?t.filter(":not("+this.cssSelectors.disabled+")").first():t.eq(l+1),r.hasClass(a)&&(r=t.filter(":not("+this.cssSelectors.disabled+")").first()),r.addClass(s).siblings().removeClass(s);break;case 38:if(l<=6)return;if(r=t.eq(l-7),!r.length)return;if(r.hasClass(a))return;r.addClass(s).siblings().removeClass(s);break;case 40:if(l>=t.length-7)return;if(r=t.eq(l+7),!r.length)return;if(r.hasClass(a))return;r.addClass(s).siblings().removeClass(s);break;case 13:i.click()}}}}},{key:"selectMonth",value:function(e){var t=$(e.currentTarget),s=getClassNameFromSelector(this.cssSelectors.disabled);if(!t.hasClass(s)){var a=getClassNameFromSelector(this.cssSelectors.active);t.siblings("li").removeClass(a),t.addClass(a),this.$dp.trigger(EVENT_DATE_PICKER_MONTH_UPDATE)}}},{key:"selectDate",value:function(t){var s=$(t.currentTarget),a=getClassNameFromSelector(this.cssSelectors.active);s.siblings("li").removeClass(a),s.addClass(a);var i=this.$year.val(),r=this.getSelectedMonth(),l=parseInt(s.text());this.defaults.value=new Date(i,r,l),this.$dpDisplay.val(getFormattedDate(this.defaults.value)),this.$input.val(getFormattedDate(this.defaults.value));var o=getClassNameFromSelector(this.cssSelectors.focus);$(this.cssSelectors.dpDate).removeClass(o),this.defaults.format===e.FORMAT_DATE?this.hide():this.defaults.format===e.FORMAT_DATETIME&&this.$hour.focus()}},{key:"setTimeAndHide",value:function(){var e=this.$year.val(),t=this.getSelectedMonth(),s=this.getSelectedDate(),a=parseInt(this.$hour.val()),i=parseInt(this.$minute.val()),r=this.$meridian.val();if(""===a)this.$hour.focus();else if(""===i)this.$minute.focus();else if(""===r)this.$meridian.focus();else{"pm"===r&&(a+=12);var l=new Date(e,t,s,a,i);if(isNaN(l))return void console.log("Invalid date: year:"+e+" month:"+t+" date:"+s+" hour:"+a+" minute:"+i);this.$dpDisplay.val(getFormattedDateTime(l,!0)),this.$input.val(getFormattedDateTime(l)),this.defaults.value=l,this.hide()}}},{key:"getYearWrapperHtml",value:function(){var e=getClassNameFromSelector(this.cssSelectors.dpYearWrapper),t=getClassNameFromSelector(this.cssSelectors.jsPrevYear),s=getClassNameFromSelector(this.cssSelectors.jsYear),a=getClassNameFromSelector(this.cssSelectors.jsNextYear);return['<div class="'+e+'">','<span class="'+t+' fa fa-caret-left"></span>','<input type="text" class="'+s+'" value="'+this.defaults.value.getFullYear()+'">','<span class="'+a+' fa fa-caret-right"></span>',"</div>"].join("")}},{key:"getMonthWrapperHtml",value:function(){this.$year||(this.$year=this.$dp.find(this.cssSelectors.jsYear));var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=new Date(this.$year.val(),0,1),s=t.getFullYear()===this.defaults.value.getFullYear(),a=this.defaults.value.getMonth(),i=0;this.defaults.minDate&&(t.getFullYear()<this.defaults.minDate.getFullYear()?i=12:t.getFullYear()===this.defaults.minDate.getFullYear()&&(i=this.defaults.minDate.getMonth()));var r=12;this.defaults.maxDate&&(t.getFullYear()>this.defaults.maxDate.getFullYear()?r=-1:t.getFullYear()===this.defaults.maxDate.getFullYear()&&(r=this.defaults.maxDate.getMonth()));for(var l=getClassNameFromSelector(this.cssSelectors.dpMonthWrapper),o=getClassNameFromSelector(this.cssSelectors.dpMonth),n=getClassNameFromSelector(this.cssSelectors.disabled),h=getClassNameFromSelector(this.cssSelectors.active),d=['<ul class="'+l+'" tabindex="0">'],c=0;c<12;c++){var p=[o];c<i||c>r?p.push(n):s&&c===a&&p.push(h);var u=["<li",'data-month="'+c+'"','class="'+p.join(" ")+'"'];u.push(">"+e[c]+"</li>"),d.push(u.join(" "))}return d.push("</ul>"),d.join("")}},{key:"getCalWrapperHtml",value:function(){var e=getClassNameFromSelector(this.cssSelectors.dpCalWrapper),t=getClassNameFromSelector(this.cssSelectors.dpWeekWrapper),s=getClassNameFromSelector(this.cssSelectors.dpDate),a=getClassNameFromSelector(this.cssSelectors.disabled),i=getClassNameFromSelector(this.cssSelectors.active),r=getClassNameFromSelector(this.cssSelectors.empty),l=['<div class="'+e+'" tabindex="0">'],o=["S","M","T","W","T","F","S"];l.push('<ul class="'+t+'">');for(var n=0;n<7;n++)l.push('<li class="'+[s,r].join(" ")+'">'+o[n]+"</li>");l.push("</ul>"),l.push('<ul class="'+t+'">');var h=this.$year.val(),d=this.getSelectedMonth();if(-1!==d){var c=new Date(h,d,1),p=1,u=32,m=c.getFullYear()===this.defaults.value.getFullYear(),f=c.getMonth()===this.defaults.value.getMonth(),v=this.defaults.value.getDate();this.defaults.minDate&&(c.getFullYear()<this.defaults.minDate.getFullYear()?p=32:c.getFullYear()===this.defaults.minDate.getFullYear()&&(c.getMonth()<this.defaults.minDate.getMonth()?p=32:c.getMonth()===this.defaults.minDate.getMonth()&&(p=this.defaults.minDate.getDate()))),this.defaults.maxDate&&(c.getFullYear()>this.defaults.maxDate.getFullYear()?u=0:c.getFullYear()===this.defaults.maxDate.getFullYear()&&(c.getMonth()>this.defaults.maxDate.getMonth()?u=0:c.getMonth()===this.defaults.maxDate.getMonth()&&(u=this.defaults.maxDate.getDate())));for(var g=0;g<c.getDay();g++)l.push('<li class="'+[s,r].join(" ")+'">&nbsp;</li>');for(var $=getDaysInMonth(h,d),C=1;C<=$;C++){var S=[s];C<p||C>u?S.push(a):m&&f&&C===v&&S.push(i),l.push('<li class="'+S.join(" ")+'">'+C+"</li>")}return l.push("</ul>"),l.push("</div>"),l.join("")}}},{key:"getTimeWrapperHtml",value:function(){for(var e=getClassNameFromSelector(this.cssSelectors.dpTimeWrapper),t=getClassNameFromSelector(this.cssSelectors.dpSelectMenuLabel),s=getClassNameFromSelector(this.cssSelectors.dpSelectMenu),a=getClassNameFromSelector(this.cssSelectors.jsHour),i=getClassNameFromSelector(this.cssSelectors.jsMinute),r=getClassNameFromSelector(this.cssSelectors.jsMeridian),l="",o=this.defaults.value.getHours(),n=this.defaults.value.getMinutes(),h='<label class="'+t+'">\n    <select class="'+s+" "+a+'">\n        <option value="">hh</option>',d=0;d<=12;d++)l="",o!==d&&o%12!==d||(l=" selected "),d=("0"+d).slice(-2),h+='<option value="'+d+'" '+l+">"+d+"</option>";h+="</select></label>";var c=[0,15,30,45],p='<label class="'+t+'">\n    <select class="'+s+" "+i+'">\n      <option value="">mm</option>';for(var u in c){l="";var m=parseInt(u)+1;n>=c[u]&&n<c[m]&&(l=" selected ");var f=("0"+c[u]).slice(-2);p+='<option value="'+f+'" '+l+">"+f+"</option>"}p+="</select></label>";var v="",g="";return o<12?v=" selected ":g=" selected ",'<div class="'+e+'">\n      <div>\n        '+h+"&nbsp;"+p+'&nbsp;<label class="'+t+'">\n    <select class="'+s+" "+r+'">\n      <option value="">----</option>\n      <option value="am" '+v+'>am</option>\n      <option value="pm" '+g+'>pm</option>\n    </select></label>\n        <button type="button">Go</button>\n      </div>\n    </div>'}},{key:"getSelectedMonth",value:function(){var e=this.$dp.find(this.cssSelectors.dpMonth+this.cssSelectors.active);return this.$dp.find(this.cssSelectors.dpMonth).index(e)}},{key:"getSelectedDate",value:function(){var e=this.$dp.find(this.cssSelectors.dpDate+this.cssSelectors.active);return parseInt(e.text())}},{key:"getOverlayHtml",value:function(){return'<div class="'+getClassNameFromSelector(this.cssSelectors.dpOverlay)+'"></div>'}}]),e}();$.fn.datepicker=function(){$(this).each(function(){var e=$(this);new DatePicker(e)})};