"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function getFormattedDate(e){return[e.getFullYear(),("0"+(e.getMonth()+1)).slice(-2),("0"+e.getDate()).slice(-2)].join("-")}function getDaysInMonth(e,t){return new Date(e,t+1,0).getDate()}function getClassNameFromSelector(e){return e.replace(".","")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,s,a){return s&&e(t.prototype,s),a&&e(t,a),t}}(),EVENT_DATE_PICKER_YEAR_UPDATE="date-picker:year-update",EVENT_DATE_PICKER_MONTH_UPDATE="date-picker:month-update",EVENT_DATE_PICKER_FORCE_EDIT="date-picker:force-edit",DatePicker=function(){function e(t){_classCallCheck(this,e);var s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1);this.defaults={value:a,minDate:a},this.cssSelectors={dp:".c-date-picker",dpFocused:".c-date-picker--focused",dpDisplay:".c-date-picker__display",dpDropDown:".c-date-picker__drop-down",dpYearWrapper:".c-date-picker__year-wrapper",dpMonthWrapper:".c-date-picker__month-wrapper",dpMonth:".c-date-picker__month",dpCalWrapper:".c-date-picker__cal-wrapper",dpWeekWrapper:".c-date-picker__week-wrapper",dpDate:".c-date-picker__date",dpOverlay:".c-date-picker__overlay",focus:".focus",active:".active",empty:".empty",disabled:".disabled",jsPrevYear:".js-date-picker-prev-year",jsYear:".js-date-picker-year",jsNextYear:".js-date-picker-next-year"},this.$input=t,this.setup(),this.bindUIActions()}return _createClass(e,[{key:"setup",value:function(){var e=getClassNameFromSelector(this.cssSelectors.dp),t=getClassNameFromSelector(this.cssSelectors.dpDisplay),s=getClassNameFromSelector(this.cssSelectors.dpDropDown);this.$input.val()&&(this.defaults.value=new Date(this.$input.val())),this.$dp=$('<div class="'+e+'"></div>'),this.$dp.insertAfter(this.$input),this.$dpDisplay=$('<input type="text" class="'+t+'" readonly>'),this.$dpDisplay.val(getFormattedDate(this.defaults.value)),this.$dp.append(this.$dpDisplay);var a=$('<div class="'+s+'"></div>');this.$dp.append(a),this.$dpYearWrapper=$(this._getYearWrapperHtml()),a.append(this.$dpYearWrapper),this.$dpMonthWrapper=$(this._getMonthWrapperHtml()),a.append(this.$dpMonthWrapper),this.$dpCalWrapper=$(this._getCalWrapperHtml()),a.append(this.$dpCalWrapper),this.$input.attr("type","hidden"),this.$dp.append(this.$input),this.$dpOverlay=$(this._getOverlayHtml()),this.$dp.append(this.$dpOverlay)}},{key:"bindUIActions",value:function(){this.$dp.on("focus",this.show.bind(this)),this.$dpDisplay.on("focus",this.show.bind(this)),this.$dpOverlay.on("click",this.hide.bind(this)),this.$dp.on("click",this.cssSelectors.jsPrevYear,function(){this.$year.val(parseInt(this.$year.val())-1),this.$dp.trigger(EVENT_DATE_PICKER_YEAR_UPDATE)}.bind(this)),this.$dp.on("click",this.cssSelectors.jsNextYear,function(){this.$year.val(parseInt(this.$year.val())+1),this.$dp.trigger(EVENT_DATE_PICKER_YEAR_UPDATE)}.bind(this)),this.$year.on("change",this.updateMonth.bind(this)),this.$dp.on(EVENT_DATE_PICKER_YEAR_UPDATE,this.updateMonth.bind(this)),this.$dp.on(EVENT_DATE_PICKER_MONTH_UPDATE,this.updateCal.bind(this)),this.$dp.on("keyup",this.cssSelectors.dpMonthWrapper,this._navigateMonthsWithKeys.bind(this)),this.$dp.on("click",this.cssSelectors.dpMonth,this.selectMonth.bind(this)),this.$dp.on("keyup",this.cssSelectors.dpCalWrapper,this._navigateDateWithKeys.bind(this)),this.$dp.on("click",this.cssSelectors.dpDate,this.selectDate.bind(this)),this.$dp.on(EVENT_DATE_PICKER_FORCE_EDIT,this.forceEditHandler.bind(this))}},{key:"show",value:function(){this.reset(),this.$dp.addClass(getClassNameFromSelector(this.cssSelectors.dpFocused))}},{key:"hide",value:function(){this.$dp.removeClass(getClassNameFromSelector(this.cssSelectors.dpFocused))}},{key:"forceEditHandler",value:function(){this.show(),this.$dp.focus()}},{key:"reset",value:function(){this.$year.val(this.defaults.value.getFullYear()),this.$dpMonthWrapper.remove(),this.$dpMonthWrapper=$(this._getMonthWrapperHtml()),this.$dpMonthWrapper.insertAfter(this.$dpYearWrapper),this.$dpCalWrapper.remove(),this.$dpCalWrapper=$(this._getCalWrapperHtml()),this.$dpCalWrapper.insertAfter(this.$dpMonthWrapper)}},{key:"updateMonth",value:function(){var e=this.$dpMonthWrapper;this.$dpMonthWrapper=$(this._getMonthWrapperHtml()),e.replaceWith(this.$dpMonthWrapper),this.$dp.trigger(EVENT_DATE_PICKER_MONTH_UPDATE)}},{key:"updateCal",value:function(){this.$dpCalWrapper.remove(),this.$dpCalWrapper=$(this._getCalWrapperHtml()),this.$dpCalWrapper.insertAfter(this.$dpMonthWrapper)}},{key:"_navigateMonthsWithKeys",value:function(e){var t=getClassNameFromSelector(this.cssSelectors.focus),s=getClassNameFromSelector(this.cssSelectors.disabled),a=$(this.cssSelectors.dpMonth+this.cssSelectors.focus);a.length||(a=$(this.cssSelectors.dpMonth+":not("+this.cssSelectors.disabled+")").first(),a.addClass(t));var r;switch(e.keyCode){case 37:r=a.prev(),r.length||(r=a.siblings(":last")),r.hasClass(s)&&(r=a.siblings(":not("+this.cssSelectors.disabled+")").last()),r.addClass(t).siblings().removeClass(t);break;case 39:r=a.next(),r.length||(r=a.siblings(":first")),r.hasClass(s)&&(r=a.siblings(":not("+this.cssSelectors.disabled+")").first()),r.addClass(t).siblings().removeClass(t);break;case 38:case 40:var i=$(this.cssSelectors.dpMonth),l=i.index(a);r=l<6?i.eq(l+6):i.eq(l-6),r.hasClass(s)||r.addClass(t).siblings().removeClass(t);break;case 13:a.click()}}},{key:"_navigateDateWithKeys",value:function(e){var t=$(this.cssSelectors.dpDate).filter(":not("+this.cssSelectors.empty+")"),s=getClassNameFromSelector(this.cssSelectors.focus),a=getClassNameFromSelector(this.cssSelectors.disabled),r=t.filter(this.cssSelectors.focus);r.length||(r=t.filter(":not("+this.cssSelectors.disabled+")").first(),r.addClass(s));var i,l=t.index(r);switch(e.keyCode){case 37:i=0===l?t.filter(":not("+this.cssSelectors.disabled+")").last():t.eq(l-1),i.hasClass(a)&&(i=t.filter(":not("+this.cssSelectors.disabled+")").last()),i.addClass(s).siblings().removeClass(s);break;case 39:i=l===t.length-1?t.filter(":not("+this.cssSelectors.disabled+")").first():t.eq(l+1),i.hasClass(a)&&(i=t.filter(":not("+this.cssSelectors.disabled+")").first()),i.addClass(s).siblings().removeClass(s);break;case 38:if(l<=6)return;if(i=t.eq(l-7),!i.length)return;if(i.hasClass(a))return;i.addClass(s).siblings().removeClass(s);break;case 40:if(l>=t.length-7)return;if(i=t.eq(l+7),!i.length)return;if(i.hasClass(a))return;i.addClass(s).siblings().removeClass(s);break;case 13:r.click()}}},{key:"selectMonth",value:function(e){var t=$(e.currentTarget),s=getClassNameFromSelector(this.cssSelectors.disabled);if(!t.hasClass(s)){var a=getClassNameFromSelector(this.cssSelectors.active);t.siblings("li").removeClass(a),t.addClass(a),this.$dp.trigger(EVENT_DATE_PICKER_MONTH_UPDATE)}}},{key:"selectDate",value:function(e){var t=$(e.currentTarget),s=getClassNameFromSelector(this.cssSelectors.active);t.siblings("li").removeClass(s),t.addClass(s);var a=this.$year.val(),r=this._getSelectedMonth(),i=parseInt(t.text());this.defaults.value=new Date(a,r,i),this.$dpDisplay.val(getFormattedDate(this.defaults.value)),this.$input.val(getFormattedDate(this.defaults.value)),this.hide()}},{key:"_getYearWrapperHtml",value:function(){var e=getClassNameFromSelector(this.cssSelectors.dpYearWrapper),t=getClassNameFromSelector(this.cssSelectors.jsPrevYear),s=getClassNameFromSelector(this.cssSelectors.jsYear),a=getClassNameFromSelector(this.cssSelectors.jsNextYear);return['<div class="'+e+'">','<span class="'+t+' fa fa-caret-left"></span>','<input type="text" class="'+s+'" value="'+this.defaults.value.getFullYear()+'">','<span class="'+a+' fa fa-caret-right"></span>',"</div>"].join("")}},{key:"_getMonthWrapperHtml",value:function(){this.$year||(this.$year=$(this.cssSelectors.jsYear));var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=new Date(this.$year.val(),0,1),s=t.getFullYear()===this.defaults.value.getFullYear(),a=this.defaults.value.getMonth(),r=0;this.defaults.minDate&&(t.getFullYear()<this.defaults.minDate.getFullYear()?r=12:t.getFullYear()===this.defaults.minDate.getFullYear()&&(r=this.defaults.minDate.getMonth()));for(var i=getClassNameFromSelector(this.cssSelectors.dpMonthWrapper),l=getClassNameFromSelector(this.cssSelectors.dpMonth),c=getClassNameFromSelector(this.cssSelectors.disabled),h=getClassNameFromSelector(this.cssSelectors.active),o=['<ul class="'+i+'" tabindex="0">'],n=0;n<12;n++){var p=[l];n<r?p.push(c):s&&n===a&&p.push(h);var d=["<li",'data-month="'+n+'"','class="'+p.join(" ")+'"'];d.push(">"+e[n]+"</li>"),o.push(d.join(" "))}return o.push("</ul>"),o.join("")}},{key:"_getCalWrapperHtml",value:function(){var e=getClassNameFromSelector(this.cssSelectors.dpCalWrapper),t=getClassNameFromSelector(this.cssSelectors.dpWeekWrapper),s=getClassNameFromSelector(this.cssSelectors.dpDate),a=getClassNameFromSelector(this.cssSelectors.disabled),r=getClassNameFromSelector(this.cssSelectors.active),i=getClassNameFromSelector(this.cssSelectors.empty),l=['<div class="'+e+'" tabindex="0">'],c=["S","M","T","W","T","F","S"];l.push('<ul class="'+t+'">');for(var h=0;h<7;h++)l.push('<li class="'+[s,i].join(" ")+'">'+c[h]+"</li>");l.push("</ul>"),l.push('<ul class="'+t+'">');var o=this.$year.val(),n=this._getSelectedMonth();if(-1!==n){var p=new Date(o,n,1),d=1,u=p.getFullYear()===this.defaults.value.getFullYear(),v=p.getMonth()===this.defaults.value.getMonth(),g=this.defaults.value.getDate();this.defaults.minDate&&(p.getFullYear()<this.defaults.minDate.getFullYear()?d=32:p.getFullYear()===this.defaults.minDate.getFullYear()&&(p.getMonth()<this.defaults.minDate.getMonth()?d=32:p.getMonth()===this.defaults.minDate.getMonth()&&(d=this.defaults.minDate.getDate())));for(var f=0;f<p.getDay();f++)l.push('<li class="'+[s,i].join(" ")+'">&nbsp;</li>');for(var m=getDaysInMonth(o,n),C=1;C<=m;C++){var $=[s];C<d?$.push(a):u&&v&&C===g&&$.push(r),l.push('<li class="'+$.join(" ")+'">'+C+"</li>")}return l.push("</ul>"),l.push("</div>"),l.join("")}}},{key:"_getSelectedMonth",value:function(){var e=$(this.cssSelectors.dpMonth+this.cssSelectors.active);return $(this.cssSelectors.dpMonth).index(e)}},{key:"_getOverlayHtml",value:function(){return'<div class="'+getClassNameFromSelector(this.cssSelectors.dpOverlay)+'"></div>'}}]),e}();$.fn.zyreDatePicker=function(){$(this).each(function(){var e=$(this);new DatePicker(e)})};