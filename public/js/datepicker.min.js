"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function getFormattedDate(dt){return[dt.getFullYear(),("0"+(dt.getMonth()+1)).slice(-2),("0"+dt.getDate()).slice(-2)].join("-")}function getFormattedDateTime(dt){var display=arguments.length>1&&void 0!==arguments[1]&&arguments[1],time=[("0"+dt.getHours()).slice(-2),("0"+dt.getMinutes()).slice(-2),("0"+dt.getSeconds()).slice(-2)].join(":");if(display){var hours=dt.getHours(),a="am";hours>12&&(hours-=12,a="pm"),time=[("0"+hours).slice(-2),("0"+dt.getMinutes()).slice(-2)].join(":"),time=time+" "+a}return getFormattedDate(dt)+" "+time}function getDaysInMonth(year,month){return new Date(year,month+1,0).getDate()}function getClassNameFromSelector(selector){return selector.replace(".","")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),EVENT_DATE_PICKER_YEAR_UPDATE="date-picker:year-update",EVENT_DATE_PICKER_MONTH_UPDATE="date-picker:month-update",EVENT_DATE_PICKER_FORCE_EDIT="date-picker:force-edit",EVENT_DATE_PICKER_ENTER="date-picker:enter",EVENT_DATE_PICKER_EXIT="date-picker:exit",DatePicker=function(){function DatePicker($input){_classCallCheck(this,DatePicker),this.defaults={},this.cssSelectors={dp:".c-date-picker",dpFocused:".c-date-picker--focused",dpDisplay:".c-date-picker__display",dpDropDown:".c-date-picker__drop-down",dpYearWrapper:".c-date-picker__year-wrapper",dpMonthWrapper:".c-date-picker__month-wrapper",dpMonth:".c-date-picker__month",dpCalWrapper:".c-date-picker__cal-wrapper",dpWeekWrapper:".c-date-picker__week-wrapper",dpDate:".c-date-picker__date",dpTimeWrapper:".c-date-picker__time-wrapper",dpOverlay:".c-date-picker__overlay",focus:".focus",active:".active",empty:".empty",disabled:".disabled",jsPrevYear:".js-date-picker-prev-year",jsYear:".js-date-picker-year",jsNextYear:".js-date-picker-next-year",jsHour:".js-date-picker-hour",jsMinute:".js-date-picker-minute",jsMeridian:".js-date-picker-meridian"},this.$input=$input,this.parseInputAttrs(),this.setup(),this.bindUIActions()}return _createClass(DatePicker,null,[{key:"FORMAT_DATE",get:function(){return"date"}},{key:"FORMAT_DATETIME",get:function(){return"datetime"}}]),_createClass(DatePicker,[{key:"parseInputAttrs",value:function(){function parseDateFromString(dateStr){var today=new Date,tomorrow=new Date(today.getFullYear(),today.getMonth(),today.getDate()+1);switch(dateStr){case"today":return today;case"tomorrow":return tomorrow;default:return new Date(dateStr)}}var minDateStr=this.$input.data("min-date"),minDate=parseDateFromString(minDateStr);isNaN(minDate)||(this.defaults.minDate=minDate);var valueStr=this.$input.val(),value=parseDateFromString(valueStr);isNaN(value)?this.defaults.value=parseDateFromString("today"):this.defaults.value=value;var formatStr=this.$input.data("format");formatStr||(formatStr=DatePicker.FORMAT_DATE),-1!==[DatePicker.FORMAT_DATE,DatePicker.FORMAT_DATETIME].indexOf(formatStr)&&(this.defaults.format=formatStr)}},{key:"setup",value:function(){var dpClass=getClassNameFromSelector(this.cssSelectors.dp),dpDisplayClass=getClassNameFromSelector(this.cssSelectors.dpDisplay),dpDropDown=getClassNameFromSelector(this.cssSelectors.dpDropDown);this.$dp=$('<div class="'+dpClass+'"></div>'),this.$dp.insertAfter(this.$input),this.$dpDisplay=$('<input type="text" class="'+dpDisplayClass+'" readonly>');var displayValue=getFormattedDate(this.defaults.value);this.defaults.format===DatePicker.FORMAT_DATETIME&&(displayValue=getFormattedDateTime(this.defaults.value,!0)),this.$dpDisplay.val(displayValue),this.$dp.append(this.$dpDisplay);var $dpDropDown=$('<div class="'+dpDropDown+'"></div>');this.$dp.append($dpDropDown),this.$dpYearWrapper=$(this.getYearWrapperHtml()),$dpDropDown.append(this.$dpYearWrapper),this.$dpMonthWrapper=$(this.getMonthWrapperHtml()),$dpDropDown.append(this.$dpMonthWrapper),this.$dpCalWrapper=$(this.getCalWrapperHtml()),$dpDropDown.append(this.$dpCalWrapper),this.defaults.format===DatePicker.FORMAT_DATETIME&&(this.$dpTimeWrapper=$(this.getTimeWrapperHtml()),$dpDropDown.append(this.$dpTimeWrapper)),this.$input.attr("type","hidden"),this.$dp.append(this.$input),this.$dpOverlay=$(this.getOverlayHtml()),this.$dp.append(this.$dpOverlay),this.$year=this.$dp.find(this.cssSelectors.jsYear),this.$hour=this.$dp.find(this.cssSelectors.jsHour),this.$minute=this.$dp.find(this.cssSelectors.jsMinute),this.$meridian=this.$dp.find(this.cssSelectors.jsMeridian)}},{key:"bindUIActions",value:function(){this.$dp.on("focus",this.show.bind(this)),this.$dpDisplay.on("focus",this.show.bind(this)),this.$dpOverlay.on("click",this.hide.bind(this)),this.$dp.on("click",this.cssSelectors.jsPrevYear,function(){this.$year.val(parseInt(this.$year.val())-1),this.$dp.trigger(EVENT_DATE_PICKER_YEAR_UPDATE)}.bind(this)),this.$dp.on("click",this.cssSelectors.jsNextYear,function(){this.$year.val(parseInt(this.$year.val())+1),this.$dp.trigger(EVENT_DATE_PICKER_YEAR_UPDATE)}.bind(this)),this.$year.on("change",function(ev){this.updateMonth()}.bind(this));var disabledClass=getClassNameFromSelector(this.cssSelectors.disabled);this.$year.on("keyup",function(ev){if(13!==ev.keyCode)return this.$dpMonthWrapper.addClass(disabledClass),void this.$dpCalWrapper.addClass(disabledClass);this.$dpMonthWrapper.removeClass(disabledClass),this.$dpCalWrapper.removeClass(disabledClass),this.$dpMonthWrapper.focus(),this.navigateMonthsWithKeys()}.bind(this)),this.$year.on("blur",function(ev){this.$dpMonthWrapper.focus()}.bind(this)),this.$dp.on(EVENT_DATE_PICKER_YEAR_UPDATE,this.updateMonth.bind(this)),this.$dp.on(EVENT_DATE_PICKER_MONTH_UPDATE,this.updateCal.bind(this)),this.$dp.on("keyup",this.cssSelectors.dpMonthWrapper,this.navigateMonthsWithKeys.bind(this)),this.$dp.on("click",this.cssSelectors.dpMonth,this.selectMonth.bind(this)),this.$dp.on("keyup",this.cssSelectors.dpCalWrapper,this.navigateDateWithKeys.bind(this)),this.$dp.on("click",this.cssSelectors.dpDate,this.selectDate.bind(this)),this.$dp.on(EVENT_DATE_PICKER_FORCE_EDIT,this.forceEditHandler.bind(this)),this.$dp.on("click",this.cssSelectors.dpTimeWrapper+" button",this.setTimeAndHide.bind(this)),$("body").on(EVENT_DATE_PICKER_ENTER,function(ev){ev.target!==this.$dp.get(0)&&(this.$dp.removeAttr("tabindex"),this.$dpDisplay.attr("disabled",!0))}.bind(this)),$("body").on(EVENT_DATE_PICKER_EXIT,function(ev){ev.target!==this.$dp.get(0)&&(this.$dp.attr("tabindex","0"),this.$dpDisplay.removeAttr("disabled"))}.bind(this))}},{key:"show",value:function(){this.reset(),this.$dp.addClass(getClassNameFromSelector(this.cssSelectors.dpFocused)),$("html,body").css({overflow:"hidden"}),this.$dp.trigger(EVENT_DATE_PICKER_ENTER)}},{key:"hide",value:function(){this.$dp.removeClass(getClassNameFromSelector(this.cssSelectors.dpFocused)),$("html,body").css({overflow:"auto"}),this.$dp.trigger(EVENT_DATE_PICKER_EXIT),this.$dp.blur()}},{key:"forceEditHandler",value:function(){this.show(),this.$dp.focus()}},{key:"reset",value:function(){this.$year.val(this.defaults.value.getFullYear()),this.$dpMonthWrapper.remove(),this.$dpMonthWrapper=$(this.getMonthWrapperHtml()),this.$dpMonthWrapper.insertAfter(this.$dpYearWrapper),this.$dpCalWrapper.remove(),this.$dpCalWrapper=$(this.getCalWrapperHtml()),this.$dpCalWrapper.insertAfter(this.$dpMonthWrapper)}},{key:"updateMonth",value:function(){var $oldMonthWrapper=this.$dpMonthWrapper;this.$dpMonthWrapper=$(this.getMonthWrapperHtml()),$oldMonthWrapper.replaceWith(this.$dpMonthWrapper),this.$dp.trigger(EVENT_DATE_PICKER_MONTH_UPDATE)}},{key:"updateCal",value:function(){this.$dpCalWrapper.remove(),this.$dpCalWrapper=$(this.getCalWrapperHtml()),this.$dpCalWrapper.insertAfter(this.$dpMonthWrapper)}},{key:"navigateMonthsWithKeys",value:function(ev){var focusClass=getClassNameFromSelector(this.cssSelectors.focus),disabledClass=getClassNameFromSelector(this.cssSelectors.disabled);if(!this.$dpMonthWrapper.hasClass(disabledClass)){var $focusedMonth=this.$dp.find(this.cssSelectors.dpMonth+this.cssSelectors.focus);if($focusedMonth.length||($focusedMonth=this.$dp.find(this.cssSelectors.dpMonth+this.cssSelectors.active),$focusedMonth.addClass(focusClass)),$focusedMonth.length||($focusedMonth=this.$dp.find(this.cssSelectors.dpMonth+":not("+this.cssSelectors.disabled+")").first(),$focusedMonth.addClass(focusClass)),ev){var $targetMonth;switch(ev.keyCode){case 37:$targetMonth=$focusedMonth.prev(),$targetMonth.length||($targetMonth=$focusedMonth.siblings(":last")),$targetMonth.hasClass(disabledClass)&&($targetMonth=$focusedMonth.siblings(":not("+this.cssSelectors.disabled+")").last()),$targetMonth.addClass(focusClass).siblings().removeClass(focusClass);break;case 39:$targetMonth=$focusedMonth.next(),$targetMonth.length||($targetMonth=$focusedMonth.siblings(":first")),$targetMonth.hasClass(disabledClass)&&($targetMonth=$focusedMonth.siblings(":not("+this.cssSelectors.disabled+")").first()),$targetMonth.addClass(focusClass).siblings().removeClass(focusClass);break;case 38:case 40:var $months=this.$dp.find(this.cssSelectors.dpMonth),idx=$months.index($focusedMonth);$targetMonth=idx<6?$months.eq(idx+6):$months.eq(idx-6),$targetMonth.hasClass(disabledClass)||$targetMonth.addClass(focusClass).siblings().removeClass(focusClass);break;case 13:$focusedMonth.click(),this.$dpCalWrapper.focus(),this.navigateDateWithKeys()}}}}},{key:"navigateDateWithKeys",value:function(ev){var $dates=this.$dp.find(this.cssSelectors.dpDate).filter(":not("+this.cssSelectors.empty+")"),focusClass=getClassNameFromSelector(this.cssSelectors.focus),disabledClass=getClassNameFromSelector(this.cssSelectors.disabled);if(!this.$dpCalWrapper.hasClass(disabledClass)){var $focusedDate=$dates.filter(this.cssSelectors.focus);if($focusedDate.length||($focusedDate=$dates.filter(":not("+this.cssSelectors.disabled+")").first(),$focusedDate.addClass(focusClass)),ev){var $targetDate,idx=$dates.index($focusedDate);switch(ev.keyCode){case 37:$targetDate=0===idx?$dates.filter(":not("+this.cssSelectors.disabled+")").last():$dates.eq(idx-1),$targetDate.hasClass(disabledClass)&&($targetDate=$dates.filter(":not("+this.cssSelectors.disabled+")").last()),$targetDate.addClass(focusClass).siblings().removeClass(focusClass);break;case 39:$targetDate=idx===$dates.length-1?$dates.filter(":not("+this.cssSelectors.disabled+")").first():$dates.eq(idx+1),$targetDate.hasClass(disabledClass)&&($targetDate=$dates.filter(":not("+this.cssSelectors.disabled+")").first()),$targetDate.addClass(focusClass).siblings().removeClass(focusClass);break;case 38:if(idx<=6)return;if($targetDate=$dates.eq(idx-7),!$targetDate.length)return;if($targetDate.hasClass(disabledClass))return;$targetDate.addClass(focusClass).siblings().removeClass(focusClass);break;case 40:if(idx>=$dates.length-7)return;if($targetDate=$dates.eq(idx+7),!$targetDate.length)return;if($targetDate.hasClass(disabledClass))return;$targetDate.addClass(focusClass).siblings().removeClass(focusClass);break;case 13:$focusedDate.click()}}}}},{key:"selectMonth",value:function(ev){var $li=$(ev.currentTarget),disabledClass=getClassNameFromSelector(this.cssSelectors.disabled);if(!$li.hasClass(disabledClass)){var activeClass=getClassNameFromSelector(this.cssSelectors.active);$li.siblings("li").removeClass(activeClass),$li.addClass(activeClass),this.$dp.trigger(EVENT_DATE_PICKER_MONTH_UPDATE)}}},{key:"selectDate",value:function(ev){var $li=$(ev.currentTarget),activeClass=getClassNameFromSelector(this.cssSelectors.active);$li.siblings("li").removeClass(activeClass),$li.addClass(activeClass);var year=this.$year.val(),month=this.getSelectedMonth(),selectedDate=parseInt($li.text());this.defaults.value=new Date(year,month,selectedDate),this.$dpDisplay.val(getFormattedDate(this.defaults.value)),this.$input.val(getFormattedDate(this.defaults.value));var focusClass=getClassNameFromSelector(this.cssSelectors.focus);$(this.cssSelectors.dpDate).removeClass(focusClass),this.defaults.format===DatePicker.FORMAT_DATE?this.hide():this.defaults.format===DatePicker.FORMAT_DATETIME&&this.$hour.focus()}},{key:"setTimeAndHide",value:function(){var year=this.$year.val(),month=this.getSelectedMonth(),selectedDate=this.getSelectedDate(),hour=parseInt(this.$hour.val()),minute=parseInt(this.$minute.val()),meridian=this.$meridian.val();if(""===hour)this.$hour.focus();else if(""===minute)this.$minute.focus();else if(""===meridian)this.$meridian.focus();else{"pm"===meridian&&(hour+=12);var dt=new Date(year,month,selectedDate,hour,minute);if(isNaN(dt))return void console.log("Invalid date: year:"+year+" month:"+month+" date:"+selectedDate+" hour:"+hour+" minute:"+minute);this.$dpDisplay.val(getFormattedDateTime(dt,!0)),this.$input.val(getFormattedDateTime(dt)),this.defaults.value=dt,this.hide()}}},{key:"getYearWrapperHtml",value:function(){var yearWrapperClass=getClassNameFromSelector(this.cssSelectors.dpYearWrapper),prevYearClass=getClassNameFromSelector(this.cssSelectors.jsPrevYear),yearClass=getClassNameFromSelector(this.cssSelectors.jsYear),nextYearClass=getClassNameFromSelector(this.cssSelectors.jsNextYear);return['<div class="'+yearWrapperClass+'">','<span class="'+prevYearClass+' fa fa-caret-left"></span>','<input type="text" class="'+yearClass+'" value="'+this.defaults.value.getFullYear()+'">','<span class="'+nextYearClass+' fa fa-caret-right"></span>',"</div>"].join("")}},{key:"getMonthWrapperHtml",value:function(){this.$year||(this.$year=this.$dp.find(this.cssSelectors.jsYear));var monthLabels=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],curDate=new Date(this.$year.val(),0,1),isActiveYear=curDate.getFullYear()===this.defaults.value.getFullYear(),activeMonth=this.defaults.value.getMonth(),enabledMonth=0;this.defaults.minDate&&(curDate.getFullYear()<this.defaults.minDate.getFullYear()?enabledMonth=12:curDate.getFullYear()===this.defaults.minDate.getFullYear()&&(enabledMonth=this.defaults.minDate.getMonth()));for(var monthWrapperClass=getClassNameFromSelector(this.cssSelectors.dpMonthWrapper),monthClass=getClassNameFromSelector(this.cssSelectors.dpMonth),disabledClass=getClassNameFromSelector(this.cssSelectors.disabled),activeClass=getClassNameFromSelector(this.cssSelectors.active),html=['<ul class="'+monthWrapperClass+'" tabindex="0">'],i=0;i<12;i++){var classList=[monthClass];i<enabledMonth?classList.push(disabledClass):isActiveYear&&i===activeMonth&&classList.push(activeClass);var li=["<li",'data-month="'+i+'"','class="'+classList.join(" ")+'"'];li.push(">"+monthLabels[i]+"</li>"),html.push(li.join(" "))}return html.push("</ul>"),html.join("")}},{key:"getCalWrapperHtml",value:function(){var dpCalWrapper=getClassNameFromSelector(this.cssSelectors.dpCalWrapper),dpWeekWrapper=getClassNameFromSelector(this.cssSelectors.dpWeekWrapper),dpDate=getClassNameFromSelector(this.cssSelectors.dpDate),disabledClass=getClassNameFromSelector(this.cssSelectors.disabled),activeClass=getClassNameFromSelector(this.cssSelectors.active),emptyClass=getClassNameFromSelector(this.cssSelectors.empty),html=['<div class="'+dpCalWrapper+'" tabindex="0">'],weekDayLabels=["S","M","T","W","T","F","S"];html.push('<ul class="'+dpWeekWrapper+'">');for(var i=0;i<7;i++)html.push('<li class="'+[dpDate,emptyClass].join(" ")+'">'+weekDayLabels[i]+"</li>");html.push("</ul>"),html.push('<ul class="'+dpWeekWrapper+'">');var selectedYear=this.$year.val(),selectedMonth=this.getSelectedMonth();if(-1!==selectedMonth){var curDate=new Date(selectedYear,selectedMonth,1),enabledDate=1,isActiveYear=curDate.getFullYear()===this.defaults.value.getFullYear(),isActiveMonth=curDate.getMonth()===this.defaults.value.getMonth(),activeDate=this.defaults.value.getDate();this.defaults.minDate&&(curDate.getFullYear()<this.defaults.minDate.getFullYear()?enabledDate=32:curDate.getFullYear()===this.defaults.minDate.getFullYear()&&(curDate.getMonth()<this.defaults.minDate.getMonth()?enabledDate=32:curDate.getMonth()===this.defaults.minDate.getMonth()&&(enabledDate=this.defaults.minDate.getDate())));for(var e=0;e<curDate.getDay();e++)html.push('<li class="'+[dpDate,emptyClass].join(" ")+'">&nbsp;</li>');for(var maxDate=getDaysInMonth(selectedYear,selectedMonth),d=1;d<=maxDate;d++){var classList=[dpDate];d<enabledDate?classList.push(disabledClass):isActiveYear&&isActiveMonth&&d===activeDate&&classList.push(activeClass),html.push('<li class="'+classList.join(" ")+'">'+d+"</li>")}return html.push("</ul>"),html.push("</div>"),html.join("")}}},{key:"getTimeWrapperHtml",value:function(){for(var timeWrapperClassName=getClassNameFromSelector(this.cssSelectors.dpTimeWrapper),hourClassName=getClassNameFromSelector(this.cssSelectors.jsHour),minClassName=getClassNameFromSelector(this.cssSelectors.jsMinute),meridianClassName=getClassNameFromSelector(this.cssSelectors.jsMeridian),hour='<select class="'+hourClassName+'">\n      <option value="">hh</option>',i=1;i<=12;i++)i=("0"+i).slice(-2),hour+='<option value="'+i+'">'+i+"</option>";hour+="</select>";var minOptions=[0,15,30,45],min='<select class="'+minClassName+'">\n      <option value="">mm</option>';for(var j in minOptions){var opt=("0"+minOptions[j]).slice(-2);min+='<option value="'+opt+'">'+opt+"</option>"}return min+="</select>",'<div class="'+timeWrapperClassName+'">\n      <div>\n        '+hour+"&nbsp;"+min+'&nbsp;<select class="'+meridianClassName+'">\n      <option value="">----</option>\n      <option value="am">am</option>\n      <option value="pm">pm</option>\n    </select>\n        <button>Go</button>\n      </div>\n    </div>'}},{key:"getSelectedMonth",value:function(){var $selectedMonth=this.$dp.find(this.cssSelectors.dpMonth+this.cssSelectors.active);return this.$dp.find(this.cssSelectors.dpMonth).index($selectedMonth)}},{key:"getSelectedDate",value:function(){var $selectedDate=this.$dp.find(this.cssSelectors.dpDate+this.cssSelectors.active);return parseInt($selectedDate.text())}},{key:"getOverlayHtml",value:function(){return'<div class="'+getClassNameFromSelector(this.cssSelectors.dpOverlay)+'"></div>'}}]),DatePicker}();$.fn.datepicker=function(){$(this).each(function(){var $input=$(this);new DatePicker($input)})};